from dataclasses import dataclass, field
from typing import List, Dict


@dataclass
class Agent:
    name: str
    purpose: str
    inputs: List[str]
    outputs: List[str]
    workflow: List[str] = field(default_factory=list)


architecture_overview: Dict[str, object] = {
    "goal": (
        "Автоматически собирать отзывы из Wildberries, очищать и структурировать их, "
        "анализировать эмоциональную окраску, выявлять проблемы и преимущества товара, "
        "а также генерировать готовые ответы продавца на отзывы."
    ),
    "architecture_type": "Мультиагентная пайплайн-система с общей БД и очередями сообщений",
    "core_entities": [
        "Источники данных (WB API)",
        "Очереди задач / событий",
        "Общая БД (raw → cleaned → enriched)",
        "LLM-агенты с узкой специализацией",
        "Слой вывода (дашборд / отчет / API)",
    ],
}


agents: List[Agent] = [
    Agent(
        name="Агент 1 — Источник первичных данных",
        purpose=(
            "Получение сырых данных из Wildberries и приведение их к чистому, "
            "унифицированному и пригодному для анализа виду."
        ),
        inputs=[
            "Сырые данные из API Wildberries (review_id, product_id, user_id, rating, review_text, review_date, seller_reply, метаданные)",
        ],
        outputs=[
            "Очищенный и структурированный датасет",
            "Базовые агрегированные метрики",
            "Запись данных в центральную БД",
        ],
        workflow=[
            "Получение данных по расписанию или ручному запросу",
            "Поддержка выборок по SKU, бренду или категории",
            "Проверка новых отзывов и защита от повторной загрузки",
            "Стандартизация формата в единую схему",
            "Очистка текста: удаление HTML, спецсимволов, повторов, шаблонных фраз, дубликатов",
            "Проверка релевантности (LLM или rule-based)",
            "Расчет базовых метрик (количество, средний/медианный рейтинг, распределение, динамика, доля негатива)",
            "Сохранение в таблицы raw_reviews, clean_reviews, summary_metrics и эмиссия события для Агента 2",
        ],
    ),
    Agent(
        name="Агент 2 — Анализ эмоциональной тональности",
        purpose="Корректно распределить отзывы по эмоциональным категориям с учетом несоответствий рейтинга и текста.",
        inputs=["Очищенный датасет от Агента 1"],
        outputs=["Массивы негативных, нейтральных и позитивных отзывов"],
        workflow=[
            "Первичная классификация по рейтингу (1–2 негатив, 3 нейтрал, 4–5 позитив)",
            "LLM-проверка противоречий рейтинга и текста, корректировка категорий",
            "Фиксация final_sentiment для каждого review_id",
            "Передача негативных отзывов Агенту 3, позитивных Агенту 4, нейтральных в архив/по выбору",
        ],
    ),
    Agent(
        name="Агент 3 — Аналитик проблем",
        purpose="Выявить ключевые проблемы товара, их частоту и подтверждающие цитаты.",
        inputs=["Массив негативных отзывов"],
        outputs=["Структурированный отчет по проблемам"],
        workflow=[
            "Тематическая классификация каждого отзыва (LLM, 1–3 темы)",
            "Использование словаря или динамическое формирование тем (качество, размер, брак, запах, упаковка и т.д.)",
            "Агрегация частот и долей по темам, ранжирование",
            "Поиск 2–3 репрезентативных цитат на топовые проблемы",
            "Передача отчета в систему вывода",
        ],
    ),
    Agent(
        name="Агент 4 — Аналитик успехов",
        purpose="Понять, что именно нравится покупателям, и превратить это в маркетинговые инсайты.",
        inputs=["Массив позитивных отзывов"],
        outputs=["Структурированный отчет по преимуществам"],
        workflow=[
            "LLM-выделение причин похвалы (качество, цена, внешний вид, удобство, соответствие описанию и др.)",
            "Подсчет упоминаний и долей для каждого преимущества",
            "Формирование отчета и передача в слой вывода",
        ],
    ),
    Agent(
        name="Агент 5 — Генерация ответов",
        purpose="Автоматически создавать готовые ответы продавца на отзывы покупателей.",
        inputs=["Темы проблем", "Темы преимуществ", "Контекст запроса (тон, бренд, стиль)",],
        outputs=["Текстовые шаблоны ответов"],
        workflow=[
            "Определение контекста: тип отзыва, тема, желаемый стиль (официальный/дружелюбный/нейтральный)",
            "Генерация ответов с учетом эмпатии или благодарности и бренд-тональности",
            "Создание 2–3 вариантов (формальный, полуформальный, дружелюбный)",
            "Выдача готовых блоков текста",
        ],
    ),
]


def print_architecture() -> None:
    print("Цель системы:")
    print(f"- {architecture_overview['goal']}\n")

    print("Тип архитектуры:")
    print(f"- {architecture_overview['architecture_type']}\n")

    print("Ключевые сущности:")
    for entity in architecture_overview["core_entities"]:
        print(f"- {entity}")
    print()

    print("Агенты и их роль:")
    for agent in agents:
        print(f"\n{agent.name}")
        print(f"Назначение: {agent.purpose}")
        print("Входные данные:")
        for item in agent.inputs:
            print(f"- {item}")
        print("Выходные данные:")
        for item in agent.outputs:
            print(f"- {item}")
        print("Основные шаги:")
        for step in agent.workflow:
            print(f"- {step}")


if __name__ == "__main__":
    print_architecture()
